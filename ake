#!/usr/bin/env nu

def main [] {}

def 'main publish' [version: string, packages?: string = 'common,node,browser'] {
  update-version $version
  let pkgs = ($packages | split row ',')
  for pkg in $pkgs {
    publish $pkg $version
  }
}

# Run node example
def --wrapped 'main example node' [...args] {
  cd examples/node
  ./ake start ...$args
}

# Run browser example
def 'main example browser' [] {
  cd examples/browser
  ./ake start
}


def publish [package: string, version: string] {
  cd $'packages/($package)'
  update-version $version
  ./ake publish
}

def update-version [version: string] {
  sed -i $'s/"version": ".*"/"version": "($version)"/' package.json
}